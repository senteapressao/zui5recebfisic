<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Error Handling and User Feedback Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- UI5 Bootstrap -->
    <script id="sap-ui-bootstrap"
        src="https://ui5.sap.com/1.108.0/resources/sap-ui-core.js"
        data-sap-ui-libs="sap.m,sap.ui.core"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-resourceroots='{
            "zui5recebfisic": "../"
        }'
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true">
    </script>
    
    <style>
        body {
            font-family: "72", Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #0070f2;
            margin-bottom: 15px;
        }
        
        .test-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-input {
            margin-bottom: 10px;
        }
        
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .status.success {
            background-color: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #81c784;
        }
        
        .status.error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #e57373;
        }
        
        .status.info {
            background-color: #e3f2fd;
            color: #1976d2;
            border: 1px solid #64b5f6;
        }
    </style>
</head>
<body>
    <h1>Error Handling and User Feedback Test</h1>
    <p>This page tests the comprehensive error handling and user feedback implementation.</p>
    
    <div class="test-container">
        <div class="test-title">1. Input Validation Tests</div>
        <div class="test-description">
            Test input validation with error highlighting and success feedback.
        </div>
        <div id="inputValidationTest"></div>
        <div class="test-buttons">
            <div id="testValidationButton"></div>
            <div id="clearValidationButton"></div>
        </div>
        <div id="validationStatus" class="status" style="display: none;"></div>
    </div>
    
    <div class="test-container">
        <div class="test-title">2. Error Message Tests</div>
        <div class="test-description">
            Test different types of error messages and dialogs.
        </div>
        <div class="test-buttons">
            <div id="showErrorButton"></div>
            <div id="showWarningButton"></div>
            <div id="showSuccessButton"></div>
            <div id="showConfirmButton"></div>
        </div>
    </div>
    
    <div class="test-container">
        <div class="test-title">3. Service Error Handling Tests</div>
        <div class="test-description">
            Test service error handling with different error types and retry options.
        </div>
        <div class="test-buttons">
            <div id="test404ErrorButton"></div>
            <div id="test500ErrorButton"></div>
            <div id="testNetworkErrorButton"></div>
            <div id="testRetryErrorButton"></div>
        </div>
    </div>
    
    <div class="test-container">
        <div class="test-title">4. Progress and Loading Tests</div>
        <div class="test-description">
            Test progress dialogs and loading indicators.
        </div>
        <div class="test-buttons">
            <div id="showProgressButton"></div>
            <div id="showBusyButton"></div>
        </div>
    </div>
    
    <div class="test-container">
        <div class="test-title">5. Destructive Action Tests</div>
        <div class="test-description">
            Test confirmation dialogs for destructive actions.
        </div>
        <div class="test-buttons">
            <div id="showDeleteConfirmButton"></div>
            <div id="showExitConfirmButton"></div>
        </div>
    </div>

    <script>
        sap.ui.getCore().attachInit(function() {
            sap.ui.require([
                "sap/m/Input",
                "sap/m/Button",
                "sap/m/VBox",
                "sap/m/MessageBox",
                "sap/m/MessageToast",
                "zui5recebfisic/controller/BaseController"
            ], function(Input, Button, VBox, MessageBox, MessageToast, BaseController) {
                
                // Create a test controller instance
                var oTestController = new BaseController();
                
                // Mock the required methods
                oTestController.getView = function() {
                    return {
                        getModel: function() {
                            return new sap.ui.model.json.JSONModel({});
                        },
                        setModel: function() {
                            return this;
                        }
                    };
                };
                
                oTestController.getOwnerComponent = function() {
                    return {
                        getRouter: function() {
                            return {
                                navTo: function() {}
                            };
                        },
                        getModel: function() {
                            return new sap.ui.model.json.JSONModel({});
                        }
                    };
                };
                
                // Test 1: Input Validation
                var oTestInput = new Input({
                    id: "testInput",
                    placeholder: "Enter some text to test validation",
                    width: "100%"
                });
                
                oTestController.byId = function(sId) {
                    if (sId === "testInput") {
                        return oTestInput;
                    }
                    return null;
                };
                
                var oValidationContainer = new VBox({
                    items: [oTestInput]
                });
                oValidationContainer.placeAt("inputValidationTest");
                
                var oTestValidationButton = new Button({
                    text: "Test Validation",
                    type: "Emphasized",
                    press: function() {
                        var sValue = oTestInput.getValue();
                        var oStatus = document.getElementById("validationStatus");
                        
                        if (!sValue || sValue.trim() === "") {
                            oTestController.setInputError("testInput", "This field is required");
                            oStatus.className = "status error";
                            oStatus.textContent = "Validation failed: Field is required";
                            oStatus.style.display = "block";
                        } else if (sValue.length < 3) {
                            oTestController.setInputError("testInput", "Minimum 3 characters required");
                            oStatus.className = "status error";
                            oStatus.textContent = "Validation failed: Minimum 3 characters required";
                            oStatus.style.display = "block";
                        } else {
                            oTestController.setInputSuccess("testInput", "Valid input");
                            oStatus.className = "status success";
                            oStatus.textContent = "Validation passed: Input is valid";
                            oStatus.style.display = "block";
                        }
                    }
                });
                oTestValidationButton.placeAt("testValidationButton");
                
                var oClearValidationButton = new Button({
                    text: "Clear Validation",
                    press: function() {
                        oTestController.clearInputValidation("testInput");
                        var oStatus = document.getElementById("validationStatus");
                        oStatus.style.display = "none";
                    }
                });
                oClearValidationButton.placeAt("clearValidationButton");
                
                // Test 2: Error Messages
                var oShowErrorButton = new Button({
                    text: "Show Error",
                    type: "Reject",
                    press: function() {
                        oTestController.showErrorMessage("This is a test error message with detailed information about what went wrong.");
                    }
                });
                oShowErrorButton.placeAt("showErrorButton");
                
                var oShowWarningButton = new Button({
                    text: "Show Warning",
                    type: "Critical",
                    press: function() {
                        oTestController.showWarningMessage("This is a test warning message to alert the user about potential issues.");
                    }
                });
                oShowWarningButton.placeAt("showWarningButton");
                
                var oShowSuccessButton = new Button({
                    text: "Show Success",
                    type: "Success",
                    press: function() {
                        oTestController.showSuccessMessage("This is a test success message confirming the operation completed successfully.");
                    }
                });
                oShowSuccessButton.placeAt("showSuccessButton");
                
                var oShowConfirmButton = new Button({
                    text: "Show Confirmation",
                    type: "Emphasized",
                    press: function() {
                        oTestController.showConfirmDialog(
                            "Are you sure you want to proceed with this test action?",
                            function() {
                                MessageToast.show("User confirmed the action");
                            },
                            function() {
                                MessageToast.show("User cancelled the action");
                            }
                        );
                    }
                });
                oShowConfirmButton.placeAt("showConfirmButton");
                
                // Test 3: Service Error Handling
                var oTest404Button = new Button({
                    text: "Test 404 Error",
                    press: function() {
                        var oError = {
                            statusCode: 404,
                            message: "Resource not found"
                        };
                        oTestController.handleServiceError(oError, {
                            context: "Test 404 Error"
                        });
                    }
                });
                oTest404Button.placeAt("test404ErrorButton");
                
                var oTest500Button = new Button({
                    text: "Test 500 Error",
                    press: function() {
                        var oError = {
                            statusCode: 500,
                            responseText: JSON.stringify({
                                error: {
                                    message: {
                                        value: "Internal server error occurred"
                                    },
                                    innererror: {
                                        errordetails: [
                                            { message: "Database connection failed" },
                                            { message: "Transaction rolled back" }
                                        ]
                                    }
                                }
                            })
                        };
                        oTestController.handleServiceError(oError, {
                            context: "Test 500 Error"
                        });
                    }
                });
                oTest500Button.placeAt("test500ErrorButton");
                
                var oTestNetworkButton = new Button({
                    text: "Test Network Error",
                    press: function() {
                        var oError = {
                            statusCode: 0,
                            message: "Network Error: Failed to fetch"
                        };
                        oTestController.handleServiceError(oError, {
                            context: "Test Network Error"
                        });
                    }
                });
                oTestNetworkButton.placeAt("testNetworkErrorButton");
                
                var oTestRetryButton = new Button({
                    text: "Test Retry Error",
                    press: function() {
                        var oError = {
                            statusCode: 503,
                            message: "Service temporarily unavailable"
                        };
                        oTestController.handleServiceError(oError, {
                            showRetry: true,
                            onRetry: function() {
                                MessageToast.show("Retry action triggered");
                            },
                            context: "Test Retry Error"
                        });
                    }
                });
                oTestRetryButton.placeAt("testRetryErrorButton");
                
                // Test 4: Progress and Loading
                var oShowProgressButton = new Button({
                    text: "Show Progress Dialog",
                    press: function() {
                        oTestController.showProgressDialog("Processing", "Please wait while we process your request...");
                        
                        setTimeout(function() {
                            oTestController.updateProgressDialog("Almost done...");
                        }, 2000);
                        
                        setTimeout(function() {
                            oTestController.hideProgressDialog();
                            MessageToast.show("Progress completed");
                        }, 4000);
                    }
                });
                oShowProgressButton.placeAt("showProgressButton");
                
                var oShowBusyButton = new Button({
                    text: "Show Busy Indicator",
                    press: function() {
                        oTestController.showBusyIndicator("Loading data...");
                        
                        setTimeout(function() {
                            oTestController.hideBusyIndicator();
                            MessageToast.show("Loading completed");
                        }, 3000);
                    }
                });
                oShowBusyButton.placeAt("showBusyButton");
                
                // Test 5: Destructive Actions
                var oShowDeleteButton = new Button({
                    text: "Test Delete Confirmation",
                    type: "Reject",
                    press: function() {
                        oTestController.showDestructiveConfirmDialog(
                            "Confirm Deletion",
                            "Are you sure you want to delete this item?\n\nThis action cannot be undone.",
                            function() {
                                MessageToast.show("Item deleted");
                            },
                            function() {
                                MessageToast.show("Deletion cancelled");
                            }
                        );
                    }
                });
                oShowDeleteButton.placeAt("showDeleteConfirmButton");
                
                var oShowExitButton = new Button({
                    text: "Test Exit Confirmation",
                    press: function() {
                        oTestController.showDestructiveConfirmDialog(
                            "Exit Application",
                            "Are you sure you want to exit the application?\n\nAny unsaved changes will be lost.",
                            function() {
                                MessageToast.show("Application exit confirmed");
                            },
                            function() {
                                MessageToast.show("Exit cancelled");
                            },
                            {
                                emphasizedAction: "Exit"
                            }
                        );
                    }
                });
                oShowExitButton.placeAt("showExitConfirmButton");
                
                // Show initial success message
                MessageToast.show("Error handling test page loaded successfully!");
            });
        });
    </script>
</body>
</html>